<!DOCTYPE html>
<html dir="rtl" lang="he">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול מסמכים - משופר</title>
    <script type="module">
        // Import document registry
        import { DOCUMENT_TYPES, CATEGORIES, formatDocumentName, getDocumentDropdownOptions, requiresDetails, getDetailsSchema } from './document-types.js';
        // Expose to global scope for inline handlers
        window.DocRegistry = { DOCUMENT_TYPES, CATEGORIES, formatDocumentName, getDocumentDropdownOptions, requiresDetails, getDetailsSchema };
    </script>
    <link rel="stylesheet" href="assets/css/common.css">
    <link rel="stylesheet" href="assets/css/document-manager.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🗂️ ניהול מסמכים</h1>
            <p>משרד רו״ח משה עציץ</p>
        </div>

        <div class="help-banner">
            <h2>
                <span>💡</span>
                <span>ברוכים הבאים למערכת ניהול המסמכים</span>
            </h2>
            <p>כאן תוכלו להסיר מסמכים לא רלוונטיים ללקוח ולהוסיף מסמכים שחסרים לו</p>
        </div>

        <div id="alert" class="alert"></div>

        <div class="instructions">
            <h3>
                <span>📝</span>
                <span>איך להשתמש במערכת?</span>
            </h3>
            <ul class="instruction-steps">
                <li><strong>הסרת מסמכים:</strong> סמן את התיבות ליד מסמכים שאינם רלוונטיים - הם יוסרו מרשימת המסמכים של
                    הלקוח</li>
                <li><strong>הוסף מסמכים חדשים:</strong> בחר מסמכים מהרשימה הנפתחת או הזן שם מסמך מותאם אישית</li>
                <li><strong>הוסף הערות:</strong> אם יש הערות נוספות, הוסף אותן בשדה ההערות</li>
                <li><strong>שמור שינויים:</strong> לחץ על כפתור "שמור שינויים" - אימייל יישלח אוטומטית למשרד</li>
            </ul>
        </div>

        <div class="client-info">
            <h2>👤 פרטי לקוח</h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">
                        <span>👤</span>
                        <span>שם לקוח</span>
                    </div>
                    <div class="info-value" id="clientName">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">
                        <span>💑</span>
                        <span>בן/בת זוג</span>
                    </div>
                    <div class="info-value" id="spouseName">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">
                        <span>📅</span>
                        <span>שנת מס</span>
                    </div>
                    <div class="info-value" id="year">-</div>
                </div>
            </div>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>טוען מסמכים...</p>
        </div>

        <div id="content" style="display:none;">
            <div class="section">
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-number" id="totalDocs">0</div>
                        <div class="stat-label">📄 מסמכים נדרשים כרגע</div>
                    </div>
                    <div class="stat-box removal">
                        <div class="stat-number" id="markedDocs">0</div>
                        <div class="stat-label">🚫 מסומנים להסרה</div>
                    </div>
                    <div class="stat-box addition">
                        <div class="stat-number" id="addedDocs">0</div>
                        <div class="stat-label">➕ מסומנים להוספה</div>
                    </div>
                </div>

                <h2 class="section-title">
                    <span>📋</span>
                    <span>מסמכים קיימים</span>
                    <span class="tooltip" style="margin-right: 10px;">
                        <span style="font-size: 18px; cursor: help;">ℹ️</span>
                        <span class="tooltiptext">מסמכים שתסמן יקבלו סטטוס "לא נדרש" - כלומר, הם נשארים במערכת אבל לא
                            נדרשים עוד. המשרד יקבל הודעה על השינוי.</span>
                    </span>
                </h2>
                <div class="section-subtitle">
                    💡 סמן את התיבה ליד מסמכים שאינם רלוונטיים. המסמכים יוסרו מהרשימה ולא יידרשו יותר.
                </div>
                <div id="existingDocs" class="document-list"></div>
            </div>

            <div class="section">
                <h2 class="section-title">
                    <span>➕</span>
                    <span>הוספת מסמכים</span>
                </h2>
                <div class="section-subtitle">
                    💡 בחר מסמכים מהרשימה או הוסף מסמך מותאם אישית. המסמכים שתבחר יתוספו לרשימת המסמכים הנדרשים.
                </div>

                <div class="add-section">
                    <div class="form-group">
                        <label class="form-label">
                            <span>📑</span>
                            <span>בחר מסמכים להוספה</span>
                        </label>
                        <div class="form-help">
                            👆 בחר מסמך מהרשימה - המסמך יתוסף אוטומטית למטה
                        </div>
                        <select id="docTypeSelect">
                            <option value="">-- בחר מסמך מהרשימה --</option>
                            <!-- Options populated dynamically from document-types.js -->
                        </select>

                        <!-- Detail Input Section -->
                        <div id="detailInput" class="detail-input">
                            <label id="detailLabel">פרטים נוספים:</label>
                            <input type="text" id="detailValue" placeholder="לדוגמה: שם המעסיק, שם הבנק, וכו'">
                            <button onclick="addDocumentWithDetail()">➕ הוסף מסמך</button>
                        </div>
                    </div>

                    <div id="selectedDocs" class="selected-docs empty"></div>

                    <div class="form-group">
                        <label class="form-label">
                            <span>✏️</span>
                            <span>מסמך מותאם אישית</span>
                        </label>
                        <div class="form-help">
                            📝 אם המסמך שאתה מחפש לא ברשימה, הזן את שמו כאן
                        </div>
                        <input type="text" id="customDoc" placeholder="לדוגמה: אישור מיוחד מהמוסד לביטוח לאומי..."
                            onblur="checkCustomDocDuplicate()">
                        <div id="customDocWarning"
                            style="display: none; color: #dc3545; margin-top: 8px; font-size: 14px; font-weight: bold;">
                            ⚠️ שים לב: מסמך זה כבר נבחר ברשימה למעלה
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span>💬</span>
                            <span>הערות נוספות</span>
                        </label>
                        <div class="form-help">
                            📋 הוסף כל הערה או הבהרה שתרצה להעביר למשרד (לא חובה)
                        </div>
                        <textarea id="notes"
                            placeholder="לדוגמה: נא לבקש את המסמכים ב-PDF בלבד, או כל הערה אחרת..."></textarea>
                    </div>
                </div>

                <div class="actions">
                    <button class="button" onclick="openConfirmation()">
                        <span style="position: relative; z-index: 1;">💾 שמור שינויים</span>
                    </button>
                    <button class="button secondary" onclick="resetForm()">
                        <span style="position: relative; z-index: 1;">🔄 אפס טופס</span>
                    </button>
                </div>
            </div>
        </div>

        <div id="success-message" class="empty-state" style="display: none; padding-top: 50px;">
            <div style="font-size: 80px; margin-bottom: 20px;">✅</div>
            <h2 style="color: #2c5282; margin-bottom: 15px;">הבקשה נשלחה בהצלחה!</h2>
            <p style="font-size: 18px; color: #555;">רשימת המסמכים עודכנה והודעה נשלחה למשרד.</p>
            <p style="font-size: 16px; color: #777; margin-top: 10px;">אתה יכול לסגור את הדף כעת.</p>
        </div>

    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span>⚠️</span>
                <span>אישור שינויים</span>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px;">אנא אשר את השינויים הבאים:</p>
                <div id="changesSummary" class="changes-summary"></div>
                <p
                    style="margin-top: 20px; padding: 12px; background: #fff3cd; border-radius: 8px; border-right: 4px solid #ffc107;">
                    <strong>💡 הבהרה:</strong> הסרת מסמכים: סמן את התיבות ליד מסמכים לא רלוונטיים — הם יוסרו מרשימת
                    המסמכים של הלקוח
                </p>
                <p style="margin-top: 15px; color: #666;">
                    <strong>שים לב:</strong> לאחר שמירת השינויים, יישלח אימייל אוטומטי למשרד הרואה חשבון עם פירוט
                    השינויים.
                </p>
            </div>
            <div class="modal-actions">
                <button class="button" onclick="confirmSubmit()">
                    <span style="position: relative; z-index: 1;">✅ אישור ושליחה</span>
                </button>
                <button class="button secondary" onclick="closeConfirmation()">
                    <span style="position: relative; z-index: 1;">❌ ביטול</span>
                </button>
            </div>
        </div>
    </div>

    <script src="assets/js/document-manager.js"></script>
</body>

</html>