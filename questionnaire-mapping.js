/**
 * QUESTIONNAIRE MAPPING - SINGLE SOURCE OF TRUTH
 * ===============================================
 * 
 * This file defines the mapping between Tally questionnaire questions
 * and the documents that should be created based on responses.
 * 
 * DO NOT EDIT MANUALLY unless you know what you're doing.
 * Use the admin interface at: /admin/questionnaire-mapping-editor.html
 * 
 * After editing, regenerate JSON:
 * node generate-mapping-json.js
 * 
 * Then commit both files.
 */

// Question categories for UI organization
export const QUESTION_CATEGORIES = {
    hidden: { id: 'hidden', he: 'שדות מערכת', en: 'System Fields', order: 0 },
    personal: { id: 'personal', he: 'פרטים אישיים', en: 'Personal Details', order: 1 },
    family: { id: 'family', he: 'מצב משפחתי', en: 'Family Status', order: 2 },
    children: { id: 'children', he: 'ילדים', en: 'Children', order: 3 },
    employment: { id: 'employment', he: 'תעסוקה', en: 'Employment', order: 4 },
    pension: { id: 'pension', he: 'פנסיה וגמל', en: 'Pension & Provident', order: 5 },
    nii: { id: 'nii', he: 'ביטוח לאומי', en: 'National Insurance', order: 6 },
    investments: { id: 'investments', he: 'השקעות ופיננסים', en: 'Investments & Finance', order: 7 },
    realestate: { id: 'realestate', he: 'נדל"ן', en: 'Real Estate', order: 8 },
    insurance: { id: 'insurance', he: 'ביטוח', en: 'Insurance', order: 9 },
    military: { id: 'military', he: 'צבא ושירות', en: 'Military & Service', order: 10 },
    education: { id: 'education', he: 'השכלה', en: 'Education', order: 11 },
    health: { id: 'health', he: 'בריאות', en: 'Health', order: 12 },
    donations: { id: 'donations', he: 'תרומות', en: 'Donations', order: 13 },
    withholding: { id: 'withholding', he: 'ניכויים', en: 'Withholding', order: 14 },
    other: { id: 'other', he: 'אחר', en: 'Other', order: 15 }
};

/**
 * Question mapping structure:
 * 
 * @property {string} id - Unique identifier for this mapping
 * @property {object} tallyKeys - { he: "question_xxx", en: "question_yyy" }
 * @property {object} label - { he: "Hebrew question text", en: "English question text" }
 * @property {string} type - Question type: yes_no, list, text, checkbox, hidden
 * @property {string} category - Category ID from QUESTION_CATEGORIES
 * @property {string|null} condition - "yes", "no", null (always), or checkbox value
 * @property {string[]} documents - Array of document type IDs (from document-types.js)
 * @property {boolean} isSpouse - Auto-detected: true if question is about spouse
 * @property {boolean} perItem - If true, generate one document per item in list
 * @property {string|null} detailsField - Field name to extract (e.g., "issuer_name" for employer)
 * @property {string|null} linkedQuestion - ID of related question (e.g., list question for yes/no parent)
 * @property {object} docDescription - { he: "Hebrew doc description", en: "English doc description" }
 */
export const QUESTION_MAPPINGS = [
    // ============ HIDDEN FIELDS ============
    {
        id: "hidden_report_id",
        tallyKeys: { he: "question_Ad2ZXW_eda95daa-e622-4fcb-98d6-3f0aa0649680", en: "question_WNRM5Q_21cb2748-23e4-4b6f-acbd-1b0ee32c0afe" },
        label: { he: "report_record_id", en: "report_record_id" },
        type: "hidden",
        category: "hidden",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "hidden_client_id",
        tallyKeys: { he: "question_Ad2ZXW_07088289-7dc1-4173-97cb-855bc6655b0a", en: "question_WNRM5Q_7bdf1402-3d31-4855-bf97-88a1f48c912d" },
        label: { he: "client_id", en: "client_id" },
        type: "hidden",
        category: "hidden",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "hidden_year",
        tallyKeys: { he: "question_Ad2ZXW_45f853b0-2044-45f0-bca8-4cb0db3c538a", en: "question_WNRM5Q_7da15418-e79a-4265-9726-0f92bdd4a2e9" },
        label: { he: "year", en: "year" },
        type: "hidden",
        category: "hidden",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "hidden_token",
        tallyKeys: { he: "question_Ad2ZXW_12245f33-980a-4def-8656-f87f7ed1f397", en: "question_WNRM5Q_885e9fda-7bb7-4a09-af17-892ad4fe41fa" },
        label: { he: "token", en: "token" },
        type: "hidden",
        category: "hidden",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "hidden_full_name",
        tallyKeys: { he: "question_Ad2ZXW_5cf54aa8-32b8-47cc-b2c0-a2bcddabb689", en: "question_WNRM5Q_f154cc30-448c-4960-837a-b857542fa97a" },
        label: { he: "full_name", en: "full_name" },
        type: "hidden",
        category: "hidden",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "hidden_email",
        tallyKeys: { he: "question_Ad2ZXW_64644761-68e7-45eb-aac2-18c5471941fa", en: "question_WNRM5Q_dbe5baba-db73-4a05-bd58-eb953a3c308d" },
        label: { he: "email", en: "email" },
        type: "hidden",
        category: "hidden",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },

    // ============ PERSONAL DETAILS ============
    {
        id: "personal_name",
        tallyKeys: { he: "question_vAekdl", en: "question_R0oJPP" },
        label: { he: "שם ושם משפחה", en: "First and Last Name" },
        type: "text",
        category: "personal",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "personal_email",
        tallyKeys: { he: "question_K65baX", en: "question_oyR7GM" },
        label: { he: "אימייל", en: "Email" },
        type: "text",
        category: "personal",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },

    // ============ FAMILY STATUS ============
    {
        id: "family_marital_status",
        tallyKeys: { he: "question_Lb7l6l", en: "question_GzpJlz" },
        label: { he: "מצב משפחתי בשנת המס", en: "Marital status during the tax year" },
        type: "choice",
        category: "family",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "family_qualifying_settlement",
        tallyKeys: { he: "question_67Kv1P", en: "question_J6lJA7" },
        label: { he: "האם גרת ביישוב מזכה בשנת המס?", en: "Did you live in a qualifying settlement during the tax year?" },
        type: "yes_no",
        category: "family",
        condition: "yes",
        documents: ["residency_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "family_settlement_name",
        docDescription: { he: "אישור תושבות לשנת המס מהרשות המקומית", en: "Municipality residency certificate for the tax year" }
    },
    {
        id: "family_settlement_name",
        tallyKeys: { he: "question_7WKvJP", en: "question_g0q7MK" },
        label: { he: "שם היישוב", en: "Settlement name" },
        type: "text",
        category: "family",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "family_spouse_name",
        tallyKeys: { he: "question_1ld8p1", en: "question_OzXJGA" },
        label: { he: "שם בן/בת הזוג", en: "Spouse's name" },
        type: "text",
        category: "family",
        condition: null,
        documents: [],
        isSpouse: true,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "family_marital_change",
        tallyKeys: { he: "question_J6p7MK", en: "question_V0PMJl" },
        label: { he: "האם היה שינוי בסטטוס המשפחתי (נישואין/גירושין/התאלמנות/פירוד רשמי) בשנת המס?", en: "Was there a change in marital status during the tax year?" },
        type: "yes_no",
        category: "family",
        condition: "yes",
        documents: ["id_appendix"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "family_marital_change_details",
        docDescription: { he: "ספח ת\"ז מעודכן או תעודת נישואין/גירושין/פירוד רשמי", en: "Updated ID appendix; marriage/divorce/separation documents" }
    },
    {
        id: "family_marital_change_details",
        tallyKeys: { he: "question_g0d2vD", en: "question_P69XO0" },
        label: { he: "פירוט + תאריך השינוי", en: "Details + date of change" },
        type: "text",
        category: "family",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },

    // ============ CHILDREN ============
    {
        id: "children_have_children",
        tallyKeys: { he: "question_8KaOMz", en: "question_487oro" },
        label: { he: "האם יש לך ילדים?", en: "Do you have children?" },
        type: "yes_no",
        category: "children",
        condition: "yes",
        documents: ["child_id_appendix"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "ספח תעודת זהות עדכני כולל פרטי הילד/ה", en: "Updated ID appendix including child details" }
    },
    {
        id: "children_new_child",
        tallyKeys: { he: "question_y62LzX", en: "question_EXlJWL" },
        label: { he: "האם נולד/ה או הצטרף/ה ילד/ה בשנת המס?", en: "Was a child born or added to the family during the tax year?" },
        type: "yes_no",
        category: "children",
        condition: "yes",
        documents: ["child_id_appendix"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "children_new_child_dates",
        docDescription: { he: "ספח תעודת זהות עדכני כולל פרטי הילד/ה", en: "Updated ID appendix including child details" }
    },
    {
        id: "children_new_child_dates",
        tallyKeys: { he: "question_XDJXzL", en: "question_r6OdPL" },
        label: { he: "תאריכי לידה של הילדים שנוספו בשנת המס", en: "Birthdates of children added" },
        type: "text",
        category: "children",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "children_special_ed",
        tallyKeys: { he: "question_0xBXaB", en: "question_jyo7P9" },
        label: { he: "האם יש ילדים בחינוך מיוחד?", en: "Do you have children in special education?" },
        type: "yes_no",
        category: "children",
        condition: "yes",
        documents: ["special_ed_approval"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "אישור ועדת השמה/ועדת שילוב עבור הילד (חינוך מיוחד)", en: "Placement committee approval" }
    },
    {
        id: "children_disability",
        tallyKeys: { he: "question_8Ka0Zl", en: "question_a64DYy" },
        label: { he: "האם יש ילדים שבגינם מתקבלת קצבת נכות מביטוח לאומי?", en: "Do you have children for whom you receive disability benefits?" },
        type: "yes_no",
        category: "children",
        condition: "yes",
        documents: ["child_disability_approval"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "אישור מביטוח לאומי על קבלת קצבת נכות עבור הילד", en: "National Insurance certificate for child disability allowance" }
    },
    {
        id: "children_alimony",
        tallyKeys: { he: "question_P69RpP", en: "question_kyG76j" },
        label: { he: "האם שילמת דמי מזונות בשנת המס?", en: "Did you pay child support (alimony) during the tax year?" },
        type: "yes_no",
        category: "children",
        condition: "yes",
        documents: ["alimony_judgment"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "פסק דין / הסכם גירושין (דמי מזונות)", en: "Court judgment / divorce agreement" }
    },

    // ============ EMPLOYMENT ============
    {
        id: "employment_was_employed",
        tallyKeys: { he: "question_zqylLM", en: "question_2eAJPb" },
        label: { he: "האם היית שכיר/ה בשנת המס?", en: "Were you employed as a salaried employee during the tax year?" },
        type: "yes_no",
        category: "employment",
        condition: "yes",
        documents: ["form_106"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "employment_employers_list",
        docDescription: { he: "טופס 106 לשנת המס מכל המעסיקים", en: "Form 106 (one per employer)" }
    },
    {
        id: "employment_employers_list",
        tallyKeys: { he: "question_5zjRMZ", en: "question_xpDPY9" },
        label: { he: "רשימת מעסיקים – שלך", en: "Employer list" },
        type: "list",
        category: "employment",
        condition: null,
        documents: ["form_106"],
        isSpouse: false,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "טופס 106 לשנת המס מכל המעסיקים (אחד לכל מעסיק)", en: "Form 106 (one per employer listed)" }
    },
    {
        id: "employment_spouse_was_employed",
        tallyKeys: { he: "question_d6arvd", en: "question_ZNOzav" },
        label: { he: "האם בן/בת הזוג היה/הייתה שכיר/ה בשנת המס?", en: "Was your spouse employed as a salaried employee?" },
        type: "yes_no",
        category: "employment",
        condition: "yes",
        documents: ["form_106_spouse"],
        isSpouse: true,
        perItem: false,
        detailsField: null,
        linkedQuestion: "employment_spouse_employers_list",
        docDescription: { he: "טופס 106 לשנת המס מכל המעסיקים של בן/בת הזוג", en: "Form 106 for spouse (one per employer)" }
    },
    {
        id: "employment_spouse_employers_list",
        tallyKeys: { he: "question_YQ08kW", en: "question_N6XJob" },
        label: { he: "רשימת מעסיקים – בן/בת זוג", en: "Spouse employer list" },
        type: "list",
        category: "employment",
        condition: null,
        documents: ["form_106_spouse"],
        isSpouse: true,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "טופס 106 לשנת המס מכל המעסיקים של בן/בת הזוג (אחד לכל מעסיק)", en: "Form 106 for spouse (one per employer listed)" }
    },

    // ============ PENSION & PROVIDENT ============
    {
        id: "pension_withdrawal",
        tallyKeys: { he: "question_DNkQMN", en: "question_qdGKVk" },
        label: { he: "האם משכת כספים מחברת ביטוח/קופת גמל/פנסיה/השתלמות בשנת המס?", en: "Did you withdraw funds from insurance/pension/provident fund?" },
        type: "yes_no",
        category: "pension",
        condition: "yes",
        documents: ["pension_withdrawal"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "pension_withdrawal_type",
        docDescription: { he: "אישור על המשיכת הכספים והמס שנוכה בגינם מחברת הביטוח", en: "Withdrawal certificate + tax withheld" }
    },
    {
        id: "pension_withdrawal_type",
        tallyKeys: { he: "question_lyeQvN", en: "question_QDRJVk" },
        label: { he: "איזה סוג כספים נמשכו?", en: "What type of funds were withdrawn?" },
        type: "checkbox",
        category: "pension",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },

    // ============ NATIONAL INSURANCE ============
    {
        id: "nii_disability",
        tallyKeys: { he: "question_oyeWvO", en: "question_e6r7Ro" },
        label: { he: "האם קיבלת קצבת נכות מביטוח לאומי בשנת המס?", en: "Did you receive disability benefits from National Insurance?" },
        type: "yes_no",
        category: "nii",
        condition: "yes",
        documents: ["nii_allowance_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "אישור שנתי מביטוח לאומי על קצבת נכות שהתקבלה בשנת המס", en: "Annual National Insurance allowance certificate — disability" }
    },
    {
        id: "nii_survivors",
        tallyKeys: { he: "question_XDoYDP", en: "question_vADOy8" },
        label: { he: "האם קיבלת קצבת שארים בשנת המס?", en: "Did you receive survivors' benefits during the tax year?" },
        type: "yes_no",
        category: "nii",
        condition: "yes",
        documents: ["nii_allowance_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "nii_survivors_details",
        docDescription: { he: "אישור שנתי מביטוח לאומי על קצבת שארים שהתקבלה בשנת המס", en: "Annual National Insurance allowance certificate — survivors" }
    },
    {
        id: "nii_survivors_details",
        tallyKeys: { he: "question_8KL8Kl", en: "question_K6xJlK" },
        label: { he: "פירוט קצבת שארים", en: "Survivors' benefit details" },
        type: "text",
        category: "nii",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "nii_spouse_payments",
        tallyKeys: { he: "question_Oz4vkY", en: "question_WNRMzQ" },
        label: { he: "האם בן/בת הזוג קיבל/ה תקבולים מביטוח לאומי בשנת המס? (אבטלה, דמי לידה, פגיעה בעבודה, מילואים, נכות)", en: "Did your spouse receive payments from National Insurance?" },
        type: "yes_no",
        category: "nii",
        condition: "yes",
        documents: ["nii_allowance_cert_spouse"],
        isSpouse: true,
        perItem: false,
        detailsField: null,
        linkedQuestion: "nii_spouse_payment_type",
        docDescription: { he: "אישור שנתי ספציפי מביטוח לאומי בהתאם לסוג הקצבה של בן/בת הזוג", en: "Annual National Insurance allowance certificate for spouse" }
    },
    {
        id: "nii_spouse_payment_type",
        tallyKeys: { he: "question_V0QgDM", en: "question_a64Ddy" },
        label: { he: "אילו תקבולים?", en: "Which payments?" },
        type: "checkbox",
        category: "nii",
        condition: null,
        documents: [],
        isSpouse: true,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "nii_spouse_survivors",
        tallyKeys: { he: "question_0x8vx9", en: "question_LbKJW2" },
        label: { he: "האם בן/בת הזוג קיבל/ה קצבת שארים?", en: "Did your spouse receive a survivors' pension?" },
        type: "yes_no",
        category: "nii",
        condition: "yes",
        documents: ["nii_allowance_cert_spouse"],
        isSpouse: true,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "אישור שנתי מביטוח לאומי על קצבת שארים של בן/בת הזוג", en: "Annual National Insurance allowance certificate — survivors for spouse" }
    },

    // ============ INVESTMENTS & FINANCE ============
    {
        id: "investments_securities",
        tallyKeys: { he: "question_r6a7v2", en: "question_7WKVxz" },
        label: { he: "היו לך ניירות ערך?", en: "Did you hold securities?" },
        type: "yes_no",
        category: "investments",
        condition: "yes",
        documents: ["form_867"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "investments_securities_institutions",
        docDescription: { he: "טופס 867 (אישור ניכוי מס) לשנת המס מהבנק/בית ההשקעות", en: "Form 867 (one per institution)" }
    },
    {
        id: "investments_securities_institutions",
        tallyKeys: { he: "question_48J5zA", en: "question_b7e8dE" },
        label: { he: "באילו מוסדות הוחזקו ניירות ערך?", en: "At which institutions were the securities held?" },
        type: "list",
        category: "investments",
        condition: null,
        documents: ["form_867"],
        isSpouse: false,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "טופס 867 (אישור ניכוי מס) לשנת המס מהבנק/בית ההשקעות (אחד לכל מוסד)", en: "Form 867 (one per institution listed)" }
    },
    {
        id: "investments_deposits",
        tallyKeys: { he: "question_xpMKvv", en: "question_kyG7Ej" },
        label: { he: "היו לך פיקדונות/תכניות חיסכון בבנק?", en: "Did you have bank deposits/savings plans?" },
        type: "yes_no",
        category: "investments",
        condition: "yes",
        documents: ["form_867"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "investments_deposits_banks",
        docDescription: { he: "טופס 867 (אישור ניכוי מס) לשנת המס מהבנק", en: "Form 867 (withholding tax certificate) from the bank" }
    },
    {
        id: "investments_deposits_banks",
        tallyKeys: { he: "question_ZNE0De", en: "question_vADOY8" },
        label: { he: "באילו בנקים?", en: "At which banks?" },
        type: "list",
        category: "investments",
        condition: null,
        documents: ["form_867"],
        isSpouse: false,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "טופס 867 (אישור ניכוי מס) לשנת המס מהבנק (אחד לכל בנק)", en: "Form 867 (withholding tax certificate) - one per bank" }
    },
    {
        id: "investments_crypto",
        tallyKeys: { he: "question_N6lkdO", en: "question_K6xJ1K" },
        label: { he: "האם מכרת מטבעות וירטואליים בשנת המס?", en: "Did you sell virtual currencies during the tax year?" },
        type: "yes_no",
        category: "investments",
        condition: "yes",
        documents: ["crypto_report"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "investments_crypto_details",
        docDescription: { he: "טופס 1399 המרכז את כל הקניות/המכירות והמס ששולם על הקריפטו בשנת המס", en: "Form 1399 trades summary for the tax year" }
    },
    {
        id: "investments_crypto_details",
        tallyKeys: { he: "question_qdD6vg", en: "question_LbKJp2" },
        label: { he: "פירוט", en: "Details" },
        type: "text",
        category: "investments",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "investments_gambling",
        tallyKeys: { he: "question_QDeLkX", en: "question_pKo7OE" },
        label: { he: "היו הכנסות מהימורים/הגרלות/פרסים מעל 25,000₪?", en: "Did you have income from gambling/lotteries/prizes over 25,000₪?" },
        type: "yes_no",
        category: "investments",
        condition: "yes",
        documents: ["gambling_win_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "investments_gambling_details",
        docDescription: { he: "אסמכתאות על הזכייה והמס שנוכה (הימורים/פרסים מעל 25,000 ש\"ח)", en: "Winnings proof + tax withheld" }
    },
    {
        id: "investments_gambling_details",
        tallyKeys: { he: "question_9W9VM5", en: "question_1l4JVL" },
        label: { he: "פירוט סכום/מקור", en: "Details of amount/source" },
        type: "text",
        category: "investments",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "investments_foreign_income",
        tallyKeys: { he: "question_e6Q4vl", en: "question_MbaJR0" },
        label: { he: "היו לך הכנסות מחו\"ל בשנת המס שלא דווחו בעסק?", en: "Did you have foreign income not reported in a business?" },
        type: "yes_no",
        category: "investments",
        condition: "yes",
        documents: ["foreign_income_report"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "investments_foreign_country",
        docDescription: { he: "אסמכתאות על ההכנסה ועל המס ששולם בחו\"ל; אם הוגש דו\"ח מס במדינה אחרת — לצרף גם אותו", en: "Income proof + foreign tax paid; include foreign tax return if filed" }
    },
    {
        id: "investments_foreign_country",
        tallyKeys: { he: "question_WNEy1k", en: "question_J6lJz7" },
        label: { he: "מדינה", en: "Country" },
        type: "text",
        category: "investments",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },

    // ============ REAL ESTATE ============
    {
        id: "realestate_rental_income",
        tallyKeys: { he: "question_7WLGM0", en: "question_XDoM0V" },
        label: { he: "היו לך הכנסות משכר דירה בישראל בשנת המס?", en: "Did you have rental income from property in Israel?" },
        type: "yes_no",
        category: "realestate",
        condition: "yes",
        documents: ["rent_contract_income"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "חוזה שכירות של הדירה שהשכרת (הכנסה)", en: "Lease contract for rented-out property" }
    },
    {
        id: "realestate_rental_expense",
        tallyKeys: { he: "question_Ad2Zye", en: "question_8KLPQo" },
        label: { he: "האם אתה גם שוכר דירה?", en: "Are you also renting a property?" },
        type: "yes_no",
        category: "realestate",
        condition: "yes",
        documents: ["rent_contract_expense"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "חוזה שכירות של הדירה ששכרת למגורים (הוצאה)", en: "Lease contract for rented-in residence" }
    },
    {
        id: "realestate_sold_property",
        tallyKeys: { he: "question_kyeqvo", en: "question_zqMrDE" },
        label: { he: "האם מכרת נכס מקרקעין בשנת המס?", en: "Did you sell real estate during the tax year?" },
        type: "yes_no",
        category: "realestate",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "realestate_sold_details",
        docDescription: { he: "", en: "" }
    },
    {
        id: "realestate_sold_details",
        tallyKeys: { he: "question_vAekKl", en: "question_5z9G1b" },
        label: { he: "פירוט קצר", en: "Brief details" },
        type: "text",
        category: "realestate",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "realestate_inventory",
        tallyKeys: { he: "question_K65bkX", en: "question_d60DxN" },
        label: { he: "האם יש לך מלאי בעסק?", en: "Do you have business inventory?" },
        type: "yes_no",
        category: "realestate",
        condition: "yes",
        documents: ["inventory_list"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "רשימת ספירת מלאי ליום האחרון של שנת המס", en: "Inventory count list as of last day of the tax year" }
    },

    // ============ INSURANCE ============
    {
        id: "insurance_pension_contribution",
        tallyKeys: { he: "question_pKyav8", en: "question_YQGMW0" },
        label: { he: "הפקדת עצמאית לקרן פנסיה (לא דרך משכורת)?", en: "Did you make independent contributions to a pension fund?" },
        type: "yes_no",
        category: "insurance",
        condition: "yes",
        documents: ["insurance_tax_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "insurance_pension_companies",
        docDescription: { he: "אישור מס שנתי או דוח שנתי מקוצר מחברת הביטוח", en: "Annual tax certificate from insurance company" }
    },
    {
        id: "insurance_pension_companies",
        tallyKeys: { he: "question_1ld861", en: "question_DNpJdp" },
        label: { he: "באיזה חברות ביטוח?", en: "At which insurance companies?" },
        type: "list",
        category: "insurance",
        condition: null,
        documents: ["insurance_tax_cert"],
        isSpouse: false,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "אישור מס שנתי או דוח שנתי מקוצר מחברת הביטוח (אחד לכל חברת ביטוח)", en: "Annual tax certificate (one per insurance company)" }
    },
    {
        id: "insurance_study_fund",
        tallyKeys: { he: "question_MbNBMk", en: "question_lyO7d6" },
        label: { he: "הפקדת עצמאית לקרן השתלמות?", en: "Did you make independent contributions to a study fund?" },
        type: "yes_no",
        category: "insurance",
        condition: "yes",
        documents: ["insurance_tax_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "insurance_study_fund_companies",
        docDescription: { he: "אישור מס שנתי או דוח שנתי מקוצר מחברת הביטוח", en: "Annual tax certificate from insurance company" }
    },
    {
        id: "insurance_study_fund_companies",
        tallyKeys: { he: "question_J6p7oK", en: "question_R0oJ5P" },
        label: { he: "באיזה חברות?", en: "At which companies?" },
        type: "list",
        category: "insurance",
        condition: null,
        documents: ["insurance_tax_cert"],
        isSpouse: false,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "אישור מס שנתי או דוח שנתי מקוצר מחברת הביטוח (אחד לכל חברת ביטוח)", en: "Annual tax certificate (one per insurance company)" }
    },
    {
        id: "insurance_disability",
        tallyKeys: { he: "question_g0d2zD", en: "question_oyR7MM" },
        label: { he: "הפקדת עצמאית לאובדן כושר עבודה?", en: "Did you make independent contributions to disability insurance?" },
        type: "yes_no",
        category: "insurance",
        condition: "yes",
        documents: ["insurance_tax_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "insurance_disability_companies",
        docDescription: { he: "אישור מס שנתי או דוח שנתי מקוצר מחברת הביטוח", en: "Annual tax certificate from insurance company" }
    },
    {
        id: "insurance_disability_companies",
        tallyKeys: { he: "question_y62L1X", en: "question_GzpJdz" },
        label: { he: "באיזה חברות?", en: "At which companies?" },
        type: "list",
        category: "insurance",
        condition: null,
        documents: ["insurance_tax_cert"],
        isSpouse: false,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "אישור מס שנתי או דוח שנתי מקוצר מחברת הביטוח (אחד לכל חברת ביטוח)", en: "Annual tax certificate (one per insurance company)" }
    },
    {
        id: "insurance_life",
        tallyKeys: { he: "question_a64Q7E", en: "question_b7e8xE" },
        label: { he: "הפקדת עצמאית לביטוח חיים?", en: "Did you make independent contributions to life insurance?" },
        type: "yes_no",
        category: "insurance",
        condition: "yes",
        documents: ["insurance_tax_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "insurance_life_companies",
        docDescription: { he: "אישור מס שנתי או דוח שנתי מקוצר מחברת הביטוח", en: "Annual tax certificate from insurance company" }
    },
    {
        id: "insurance_life_companies",
        tallyKeys: { he: "question_67K8aO", en: "question_AdpqLN" },
        label: { he: "באיזה חברות?", en: "At which companies?" },
        type: "list",
        category: "insurance",
        condition: null,
        documents: ["insurance_tax_cert"],
        isSpouse: false,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "אישור מס שנתי או דוח שנתי מקוצר מחברת הביטוח (אחד לכל חברת ביטוח)", en: "Annual tax certificate (one per insurance company)" }
    },
    {
        id: "insurance_mortgage",
        tallyKeys: { he: "question_XDJXQL", en: "question_OzXJ5A" },
        label: { he: "האם יש משכנתא פעילה?", en: "Do you have an active mortgage?" },
        type: "yes_no",
        category: "insurance",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "insurance_mortgage_company",
        docDescription: { he: "", en: "" }
    },
    {
        id: "insurance_mortgage_company",
        tallyKeys: { he: "question_8KaOrz", en: "question_V0PM5l" },
        label: { he: "באיזה חברת ביטוח הביטוח חיים של המשכנתא?", en: "At which insurance company is the mortgage life insurance?" },
        type: "text",
        category: "insurance",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },

    // ============ MILITARY & SERVICE ============
    {
        id: "military_discharge",
        tallyKeys: { he: "question_oyR995", en: "question_BXpQkY" },
        label: { he: "האם השתחררת מהצבא או משירות לאומי ב-3 שנים האחרונות?", en: "Were you discharged from military service in the last 3 years?" },
        type: "yes_no",
        category: "military",
        condition: "yes",
        documents: ["army_release_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "אישור שחרור משירות סדיר מאתר \"אישורים\" של צה\"ל או טופס אישור לסיום השירות הלאומי", en: "Military/national service release certificate" }
    },
    {
        id: "military_memorial",
        tallyKeys: { he: "question_0xBXkB", en: "question_P69X50" },
        label: { he: "האם היו לך במהלך שנת המס הוצאות להנצחת זכרו של קרוב משפחה שהינו חייל או שוטר שנספה במערכה ו/או לזכרו של קרוב משפחה שנספה בפעולות איבה?", en: "Did you have memorial expenses during the tax year?" },
        type: "yes_no",
        category: "military",
        condition: "yes",
        documents: ["memorial_receipts"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "military_memorial_details",
        docDescription: { he: "קבלות ומסמכים המעידים על הוצאות הנצחה והקרבה", en: "Receipts + proof of relationship" }
    },
    {
        id: "military_memorial_details",
        tallyKeys: { he: "question_zqyldM", en: "question_EXlJQL" },
        label: { he: "פירוט קרבה", en: "Details of relationship" },
        type: "text",
        category: "military",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "military_institution",
        tallyKeys: { he: "question_5z9vzN", en: "question_1l4J7L" },
        label: { he: "האם יש לך קרובי משפחה נטולי יכולת שמוחזקים במוסדות ואתה מממן אותם?", en: "Do you have incapacitated family members in institutions?" },
        type: "yes_no",
        category: "military",
        condition: "yes",
        documents: ["institution_approval"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "מסמך רשמי רלוונטי על ההוצאה והקרבה (החזקת קרוב משפחה במוסד)", en: "Official proof + relationship" }
    },

    // ============ EDUCATION ============
    {
        id: "education_degree",
        tallyKeys: { he: "question_5zjRVZ", en: "question_r6OdAL" },
        label: { he: "האם סיימת תואר בשנים האחרונות (2023 והלאה)?", en: "Did you complete a degree in recent years?" },
        type: "yes_no",
        category: "education",
        condition: "yes",
        documents: ["degree_cert"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "education_degree_type",
        docDescription: { he: "אישור זכאות לתואר ממוסד הלימודים", en: "Degree eligibility certificate" }
    },
    {
        id: "education_degree_type",
        tallyKeys: { he: "question_d6arzd", en: "question_487oxo" },
        label: { he: "סוג תואר + שנת סיום", en: "Type of degree + year of completion" },
        type: "text",
        category: "education",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },
    {
        id: "education_institution",
        tallyKeys: { he: "question_YQ089W", en: "question_jyo7Q9" },
        label: { he: "מוסד לימודים", en: "Educational institution" },
        type: "text",
        category: "education",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },

    // ============ HEALTH ============
    {
        id: "health_status_change",
        tallyKeys: { he: "question_DNkQaN", en: "question_2eAJNb" },
        label: { he: "האם היו שינויים במצב הבריאותי של מישהו בתא המשפחתי שהובילו לפטורים/הקלות במס?", en: "Were there changes in health status leading to tax exemptions?" },
        type: "yes_no",
        category: "health",
        condition: "yes",
        documents: ["medical_committee"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "health_status_details",
        docDescription: { he: "מסמך רשמי רלוונטי על הפטור/נכות (מסמכים רפואיים/ועדה רפואית)", en: "Official medical exemption/disability documentation" }
    },
    {
        id: "health_status_details",
        tallyKeys: { he: "question_lyeQzN", en: "question_xpDPa9" },
        label: { he: "פירוט", en: "Details" },
        type: "text",
        category: "health",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    },

    // ============ DONATIONS ============
    {
        id: "donations_public",
        tallyKeys: { he: "question_R0Mpj4", en: "question_ZNOz6v" },
        label: { he: "האם תרמת למוסדות ציבוריים ולא העברת את כל הקבלות (סה״כ מעל 200₪)?", en: "Did you donate to public institutions without all receipts?" },
        type: "yes_no",
        category: "donations",
        condition: "yes",
        documents: ["donation_receipts"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "קבלות מקוריות מרוכזות על תרומות לפי סעיף 46 (מעל 200 ש\"ח)", en: "Consolidated receipts — Section 46" }
    },

    // ============ WITHHOLDING ============
    {
        id: "withholding_income_tax",
        tallyKeys: { he: "question_Gz9WbL", en: "question_N6XJWb" },
        label: { he: "האם יש לקוחות שניכו לך מס הכנסה במקור בשנת המס?", en: "Did any clients withhold income tax at source?" },
        type: "yes_no",
        category: "withholding",
        condition: "yes",
        documents: ["wht_approval"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "withholding_income_tax_clients",
        docDescription: { he: "אישור שנתי על ניכוי מס במקור/בט\"ל מהלקוח", en: "Annual withholding tax certificate (one per client)" }
    },
    {
        id: "withholding_income_tax_clients",
        tallyKeys: { he: "question_Oz4vEY", en: "question_qdGKAk" },
        label: { he: "שמות הלקוחות", en: "Client names" },
        type: "list",
        category: "withholding",
        condition: null,
        documents: ["wht_approval"],
        isSpouse: false,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "אישור שנתי על ניכוי מס במקור/בט\"ל מהלקוח (אחד לכל לקוח)", en: "Annual withholding tax certificate (one per client listed)" }
    },
    {
        id: "withholding_nii",
        tallyKeys: { he: "question_V0QgNM", en: "question_QDRJ5k" },
        label: { he: "האם יש לקוחות שניכו לך ביטוח לאומי במקור בשנת המס?", en: "Did any clients withhold National Insurance at source?" },
        type: "yes_no",
        category: "withholding",
        condition: "yes",
        documents: ["wht_approval"],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "withholding_nii_clients",
        docDescription: { he: "אישור שנתי על ניכוי מס במקור/בט\"ל מהלקוח", en: "Annual withholding tax certificate (one per client)" }
    },
    {
        id: "withholding_nii_clients",
        tallyKeys: { he: "question_P61KrB", en: "question_9WZED4" },
        label: { he: "שמות הלקוחות", en: "Client names" },
        type: "list",
        category: "withholding",
        condition: null,
        documents: ["wht_approval"],
        isSpouse: false,
        perItem: true,
        detailsField: "issuer_name",
        linkedQuestion: null,
        docDescription: { he: "אישור שנתי על ניכוי מס במקור/בט\"ל מהלקוח (אחד לכל לקוח)", en: "Annual withholding tax certificate (one per client listed)" }
    },

    // ============ OTHER ============
    {
        id: "other_additional_income",
        tallyKeys: { he: "question_5zdaod", en: "question_R0zqQl" },
        label: { he: "האם היו הכנסות אחרות בשנת המס שלא צוינו בשאלון ויכולות להיות רלוונטיות?", en: "Were there other income sources in the tax year not mentioned in this questionnaire?" },
        type: "yes_no",
        category: "other",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: "other_additional_income_details",
        docDescription: { he: "", en: "" }
    },
    {
        id: "other_additional_income_details",
        tallyKeys: { he: "question_d6YJXA", en: "question_oyA8Z1" },
        label: { he: "אנא פרט את ההכנסות הנוספות", en: "Please describe the additional income sources" },
        type: "text",
        category: "other",
        condition: null,
        documents: [],
        isSpouse: false,
        perItem: false,
        detailsField: null,
        linkedQuestion: null,
        docDescription: { he: "", en: "" }
    }
];

// ============ HELPER FUNCTIONS ============

/**
 * Find mapping by Tally key (either Hebrew or English form)
 */
export function getMappingByTallyKey(tallyKey) {
    return QUESTION_MAPPINGS.find(m =>
        m.tallyKeys.he === tallyKey || m.tallyKeys.en === tallyKey
    );
}

/**
 * Find mapping by ID
 */
export function getMappingById(id) {
    return QUESTION_MAPPINGS.find(m => m.id === id);
}

/**
 * Get all mappings for a category
 */
export function getMappingsByCategory(categoryId) {
    return QUESTION_MAPPINGS.filter(m => m.category === categoryId);
}

/**
 * Get all mappings that generate documents
 */
export function getDocumentMappings() {
    return QUESTION_MAPPINGS.filter(m => m.documents.length > 0);
}

/**
 * Check if mapping should generate docs based on response value
 */
export function shouldGenerateDocs(mapping, responseValue) {
    if (mapping.documents.length === 0) return false;
    if (mapping.condition === null) return true;
    if (mapping.condition === "yes") {
        return responseValue === true || responseValue === "כן" || responseValue === "Yes" || responseValue === "yes";
    }
    if (mapping.condition === "no") {
        return responseValue === false || responseValue === "לא" || responseValue === "No" || responseValue === "no";
    }
    return responseValue === mapping.condition;
}
