<!DOCTYPE html>
<html dir="rtl" lang="he">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>驻专  - 砖专 专" 砖 注爪抓</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1><i class="fa-solid fa-lock"></i> 驻专 </h1>
            <p>砖专 专" 砖 注爪抓</p>
            <form onsubmit="login(); return false;">
                <input type="password" id="passwordInput" placeholder=" 住住" autocomplete="current-password">
            </form>
            <div id="loginError" class="login-error">住住 砖</div>
            <button class="btn btn-primary" onclick="login()" style="width: 100%;">
                <i class="fa-solid fa-rocket"></i> 住
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app">
        <!-- Persistent Navbar -->
        <nav class="admin-navbar">
            <div class="nav-brand">
                <i class="fa-solid fa-building"></i>
                驻专 
            </div>
            <div class="nav-links">
                <a href="index.html" class="active"><i class="fa-solid fa-chart-simple"></i>  拽专</a>
                <a href="document-types-viewer.html"><i class="fa-solid fa-file-lines"></i> 住 住</a>
                <a href="questionnaire-mapping-editor.html"><i class="fa-solid fa-diagram-project"></i> 驻 砖</a>
            </div>
            <div class="nav-actions">
                <button class="btn btn-secondary" onclick="refreshData()">
                    <i class="fa-solid fa-rotate-right"></i> 专注
                </button>
                <button class="btn btn-secondary" onclick="logout()">
                    <i class="fa-solid fa-right-from-bracket"></i> 转转拽
                </button>
            </div>
        </nav>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')"><i class="fa-solid fa-chart-simple"></i>  拽专
            </div>
            <div class="tab" onclick="switchTab('import')"><i class="fa-solid fa-upload"></i> 住驻转 拽转</div>
            <div class="tab" onclick="switchTab('send')"><i class="fa-solid fa-envelope"></i> 砖转 砖</div>
        </div>

        <div class="content">
            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card" onclick="toggleStageFilter('')" ondblclick="toggleStageFilter('')">
                        <div class="stat-number" id="stat-total">-</div>
                        <div class="stat-label">住" 拽转</div>
                    </div>
                    <div class="stat-card stage-1" onclick="toggleStageFilter('1')" ondblclick="toggleStageFilter('')">
                        <div class="stat-number" id="stat-stage1">-</div>
                        <div class="stat-label"><i class="fa-solid fa-clipboard-list"></i> 转 砖</div>
                    </div>
                    <div class="stat-card stage-2" onclick="toggleStageFilter('2')" ondblclick="toggleStageFilter('')">
                        <div class="stat-number" id="stat-stage2">-</div>
                        <div class="stat-label"><i class="fa-solid fa-hourglass-half"></i> 转 转砖</div>
                    </div>
                    <div class="stat-card stage-3" onclick="toggleStageFilter('3')" ondblclick="toggleStageFilter('')">
                        <div class="stat-number" id="stat-stage3">-</div>
                        <div class="stat-label"><i class="fa-solid fa-folder-open"></i> 住驻 住</div>
                    </div>
                    <div class="stat-card stage-4" onclick="toggleStageFilter('4')" ondblclick="toggleStageFilter('')">
                        <div class="stat-number" id="stat-stage4">-</div>
                        <div class="stat-label"><i class="fa-solid fa-magnifying-glass"></i> 拽</div>
                    </div>
                    <div class="stat-card stage-5" onclick="toggleStageFilter('5')" ondblclick="toggleStageFilter('')">
                        <div class="stat-number" id="stat-stage5">-</div>
                        <div class="stat-label"><i class="fa-solid fa-check-circle"></i> 砖</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2><i class="fa-solid fa-users"></i> 专砖转 拽转</h2>
                        <button class="btn btn-outline" onclick="exportToExcel()">
                            <i class="fa-solid fa-download"></i> 爪 拽住
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="filters">
                            <div class="filter-group">
                                <label><i class="fa-solid fa-magnifying-glass"></i> 驻砖:</label>
                                <input type="text" id="searchInput" placeholder="砖  ..."
                                    oninput="filterClients()">
                            </div>
                            <!-- Fixed: stageFilter moved correctly here -->
                            <div class="filter-group">
                                <label><i class="fa-solid fa-filter"></i> 住:</label>
                                <select id="stageFilter" onchange="filterClients()">
                                    <option value=""></option>
                                    <option value="1">转 砖</option>
                                    <option value="2">转 转砖</option>
                                    <option value="3">住驻 住</option>
                                    <option value="4">拽</option>
                                    <option value="5">砖</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label><i class="fa-solid fa-calendar"></i> 砖:</label>
                                <select id="yearFilter" onchange="filterClients()">
                                    <option value=""></option>
                                    <option value="2025" selected>2025</option>
                                </select>
                            </div>
                        </div>

                        <div id="clientsTableContainer">
                            <div class="empty-state">
                                <div class="empty-state-icon"><i class="fa-solid fa-chart-bar"></i></div>
                                <p>注 转...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Import Tab -->
            <div id="tab-import" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fa-solid fa-upload"></i> 住驻转 拽转</h2>
                        <div class="header-actions">
                            <button class="btn btn-outline" id="btn-mode-manual" onclick="setAddMode('manual')"><i
                                    class="fa-solid fa-plus"></i> 住驻 转</button>
                            <button class="btn btn-primary" id="btn-mode-import" onclick="setAddMode('import')"
                                disabled><i class="fa-solid fa-file-excel"></i>  拽住</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Manual Section -->
                        <div id="section-manual" style="display: none; padding: 20px;">
                            <div class="filters"
                                style="flex-direction: column; align-items: stretch; max-width: 500px; margin: 0 auto; gap: 20px;">
                                <div class="filter-group" style="flex-direction: column; align-items: start;">
                                    <label>砖 :</label>
                                    <input type="text" id="manualName" placeholder="砖专 砖专" style="width: 100%;">
                                </div>
                                <div class="filter-group" style="flex-direction: column; align-items: start;">
                                    <label>:</label>
                                    <input type="text" id="manualEmail" placeholder="israel@example.com"
                                        style="width: 100%;">
                                </div>
                                <div class="filter-group" style="flex-direction: column; align-items: start;">
                                    <label>砖转 :</label>
                                    <select id="manualYear" style="width: 100%;">
                                        <option value="2025" selected>2025</option>
                                    </select>
                                </div>
                                <button class="btn btn-success" onclick="addManualClient()"
                                    style="margin-top: 10px; width: 100%; justify-content: center;">
                                    <i class="fa-solid fa-rocket"></i> 住祝 注专转
                                </button>
                            </div>
                        </div>

                        <!-- Import Section -->
                        <div id="section-import">
                            <div class="upload-zone" id="uploadZone"
                                onclick="document.getElementById('fileInput').click()">
                                <div class="upload-zone-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
                                <h3>专专 拽抓 Excel </h3>
                                <p> 抓 专转 拽抓</p>
                                <button class="btn btn-primary"><i class="fa-solid fa-paperclip"></i> 专
                                    拽抓</button>
                                <input type="file" id="fileInput" accept=".xlsx,.xls,.csv"
                                    onchange="handleFileSelect(event)">
                            </div>

                            <div class="import-options" style="margin-top: 20px;">
                                <h4><i class="fa-solid fa-list-check"></i> 驻专 专砖:</h4>
                                <p>拽抓 Excel 注 砖转 注转:</p>
                                <table style="margin-top: 10px;">
                                    <thead>
                                        <tr>
                                            <th>name</th>
                                            <th>email</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>砖 </td>
                                            <td>moshe@example.com</td>
                                        </tr>
                                        <tr>
                                            <td>砖专 </td>
                                            <td>sara@example.com</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div id="previewSection" class="preview-section">
                                <div class="card-header" style="padding: 0; border: none; margin-bottom: 20px;">
                                    <h2><i class="fa-solid fa-eye"></i> 转爪 拽</h2>
                                </div>

                                <div class="preview-stats">
                                    <div class="preview-stat">
                                        <strong id="preview-total">0</strong>
                                        <span> 砖专转 爪</span>
                                    </div>
                                    <div class="preview-stat">
                                        <strong id="preview-valid">0</strong>
                                        <span> 转拽</span>
                                    </div>
                                    <div class="preview-stat error">
                                        <strong id="preview-errors">0</strong>
                                        <span> 砖转</span>
                                    </div>
                                    <div class="preview-stat warning">
                                        <strong id="preview-duplicates">0</strong>
                                        <span> 驻 ()</span>
                                    </div>
                                </div>

                                <div class="import-options">
                                    <h4><i class="fa-solid fa-gear"></i> 专转 :</h4>
                                    <div class="option-row">
                                        <label> 砖转 :</label>
                                        <select id="importYear">
                                            <option value="2025" selected>2025</option>
                                        </select>
                                    </div>
                                </div>

                                <div style="overflow-x: auto; margin-top: 20px;">
                                    <table id="previewTable">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>砖</th>
                                                <th></th>
                                                <th>住住</th>
                                            </tr>
                                        </thead>
                                        <tbody id="previewTableBody"></tbody>
                                    </table>
                                </div>

                                <div style="margin-top: 25px; display: flex; gap: 15px; justify-content: center;">
                                    <button class="btn btn-success" id="importBtn" onclick="startImport()">
                                        <i class="fa-solid fa-check"></i>  <span id="importCount">0</span>
                                        拽转
                                    </button>
                                    <button class="btn btn-outline" onclick="clearPreview()">
                                        <i class="fa-solid fa-xmark"></i> 
                                    </button>
                                </div>
                            </div>
                        </div> <!-- End Import Section -->
                    </div>
                </div>
            </div>

            <!-- Send Questionnaires Tab -->
            <div id="tab-send" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fa-solid fa-paper-plane"></i> 砖转 砖</h2>
                    </div>
                    <div class="card-body">
                        <div class="filters">
                            <div class="filter-group">
                                <label> 砖:</label>
                                <select id="sendYearFilter">
                                    <option value="2025" selected>2025</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="loadPendingClients()">
                                <i class="fa-solid fa-rotate-right"></i> 注 拽转 转
                            </button>
                        </div>

                        <div id="pendingClientsContainer">
                            <div class="empty-state">
                                <div class="empty-state-icon"><i class="fa-solid fa-inbox"></i></div>
                                <p>注 转...</p>
                            </div>
                        </div>

                        <div id="sendActions" style="display: none; margin-top: 25px; text-align: center;">
                            <button class="btn btn-success" onclick="sendToSelected()">
                                <i class="fa-solid fa-paper-plane"></i> 砖 专 (<span id="selectedCount">0</span>)
                            </button>
                            <button class="btn btn-primary" onclick="sendToAll()">
                                <i class="fa-solid fa-envelope-open-text"></i> 砖 
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-box">
            <div class="spinner"></div>
            <p id="loadingText">注...</p>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <div class="modal-icon" id="modalIcon"><i class="fa-solid fa-check-circle"></i></div>
            <h2 class="modal-title" id="modalTitle">砖 爪!</h2>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-stats" id="modalStats"></div>
            <button class="btn btn-primary" onclick="closeModal()">住专</button>
        </div>
    </div>

    <!-- Script -->
    <script src="script.js"></script>
</body>

</html>