// document-types.js
// âš ï¸ SINGLE SOURCE OF TRUTH - Auto-generated by admin panel
// Last updated: 2026-01-24T18:08:37.826Z

export const CATEGORIES = {
  identity: { emoji: "ðŸªª", he: "×–×”×•×ª ×•×ž×¢×ž×“ ××™×©×™", en: "Identity & Status" },
  family: { emoji: "ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦", he: "×ž×©×¤×—×” ×•×™×œ×“×™×", en: "Family & Children" },
  employment: { emoji: "ðŸ’¼", he: "×”×›× ×¡×•×ª ×ž×¢×‘×•×“×”", en: "Employment Income" },
  banks: { emoji: "ðŸ¦", he: "×‘× ×§×™× ×•×©×•×§ ×”×”×•×Ÿ", en: "Banks & Capital Markets" },
  benefits: { emoji: "ðŸ§¾", he: "×‘×™×˜×•×— ×œ××•×ž×™ ×•×§×¦×‘××•×ª", en: "Benefits (NII)" },
  insurance: { emoji: "ðŸ›¡ï¸", he: "×‘×™×˜×•×— ×•×¤× ×¡×™×”", en: "Insurance & Pension" },
  housing: { emoji: "ðŸ ", he: "×“×™×•×¨ ×•×©×›×™×¨×•×ª", en: "Housing & Rent" },
  education: { emoji: "ðŸŽ“", he: "×”×©×›×œ×”", en: "Education" },
  crypto: { emoji: "ðŸª™", he: "×§×¨×™×¤×˜×•", en: "Crypto" },
  business: { emoji: "ðŸ·ï¸", he: "×¢×¡×§/×¢×¦×ž××™", en: "Business" },
  other: { emoji: "ðŸ“Ž", he: "××—×¨", en: "Other" },
};

export const DOCUMENT_TYPES = {
  form_106: {
    id: "form_106",
    category: "employment",
    aliases: ["Form_106"],
    airtable_type: "Form_106",
    name_he: '×˜×•×¤×¡ 106 ×œ×©× ×ª {year} ×ž{employer}',
    name_en: "Form 106 for {year} from {employer}",
    details: [
      {
        "key": "employer",
        "type": "text",
        "label_he": "×©× ×”×ž×¢×¡×™×§",
        "label_en": "Employer name",
        "placeholder_he": "×œ×“×•×’×ž×”: ×—×‘×¨×ª ABC ×‘×¢\"×ž",
        "placeholder_en": "e.g.: ABC Ltd."
      }
    ],
  },

  form_106_spouse: {
    id: "form_106_spouse",
    category: "employment",
    aliases: ["Form_106_Spouse"],
    airtable_type: "Form_106_Spouse",
    name_he: '×˜×•×¤×¡ 106 ×œ×©× ×ª {year} ×ž{employer} (×‘×Ÿ/×‘×ª ×–×•×’)',
    name_en: "Form 106 for {year} from {employer} (spouse)",
    details: [
      {
        "key": "employer",
        "type": "text",
        "label_he": "×©× ×”×ž×¢×¡×™×§",
        "label_en": "Employer name",
        "placeholder_he": "×œ×“×•×’×ž×”: ×—×‘×¨×ª ABC ×‘×¢\"×ž",
        "placeholder_en": "e.g.: ABC Ltd."
      }
    ],
  },

  form_867: {
    id: "form_867",
    category: "banks",
    aliases: ["Form_867"],
    airtable_type: "Form_867",
    name_he: '×˜×•×¤×¡ 867 (××™×©×•×¨ × ×™×›×•×™ ×ž×¡) ×œ×©× ×ª {year} ×ž{institution}',
    name_en: "Form 867 (withholding tax certificate) for {year} from {institution}",
    details: [
      {
        "key": "institution",
        "type": "text",
        "label_he": "×‘× ×§ / ×‘×™×ª ×”×©×§×¢×•×ª",
        "label_en": "Bank / Broker",
        "placeholder_he": "×œ×“×•×’×ž×”: ×œ××•×ž×™ / ×ž×™×˜×‘",
        "placeholder_en": "e.g.: Leumi / Meitav"
      }
    ],
  },

  crypto_report: {
    id: "crypto_report",
    category: "crypto",
    aliases: ["Crypto_Report"],
    airtable_type: "Crypto_Report",
    name_he: '×“×•"×— ×¢×œ ×”×¨×•×•×—×™× / ×”×¤×¡×“×™× ×•×”×ž×¡ ×©× ×•×›×” (×‘×ž×™×“×” ×•× ×•×›×”) ×œ×©× ×ª {year} ×ž{platform}',
    name_en: "Report of gains/losses and tax withheld (if any) for {year} from {platform}",
    details: [
      {
        "key": "platform",
        "type": "text",
        "label_he": "×¤×œ×˜×¤×•×¨×ž×”",
        "label_en": "Platform",
        "placeholder_he": "×œ×“×•×’×ž×”: Binance / eToro",
        "placeholder_en": "e.g.: Binance / eToro"
      }
    ],
  },

  residency_cert: {
    id: "residency_cert",
    category: "identity",
    aliases: ["Residency_Cert"],
    airtable_type: "Residency_Cert",
    name_he: '××™×©×•×¨ ×ª×•×©×‘×•×ª ×œ×©× ×ª ×”×ž×¡ ×ž×”×¨×©×•×ª ×”×ž×§×•×ž×™×ª',
    name_en: "Municipality residency certificate for the tax year",
  },

  id_appendix: {
    id: "id_appendix",
    category: "identity",
    aliases: ["ID_Appendix"],
    airtable_type: "ID_Appendix",
    name_he: '×¡×¤×— ×ª"×– ×ž×¢×•×“×›×Ÿ ××• ×ª×¢×•×“×ª × ×™×©×•××™×Ÿ/×’×™×¨×•×©×™×Ÿ/×¤×™×¨×•×“ ×¨×©×ž×™ (×œ×¤×™ ×”×¦×•×¨×š)',
    name_en: "Updated ID appendix or marriage/divorce/separation certificate (as needed)",
  },

  army_release_cert: {
    id: "army_release_cert",
    category: "identity",
    aliases: ["Army_Release_Cert"],
    airtable_type: "Army_Release_Cert",
    name_he: '××™×©×•×¨ ×©×—×¨×•×¨ ×ž×©×™×¨×•×ª ×¡×“×™×¨ (× ×™×ª×Ÿ ×œ×”×•×¦×™× ××ª ×”××™×©×•×¨ ×ž××ª×¨ "××™×©×•×¨×™×")',
    name_en: "Regular service discharge certificate (can be issued via the \"Certificates\" site)",
  },

  child_id_appendix: {
    id: "child_id_appendix",
    category: "family",
    aliases: ["Child_ID_Appendix"],
    airtable_type: "Child_ID_Appendix",
    name_he: '×¡×¤×— ×ª"×– ×‘×• ×ž×•×¤×™×¢ ×”×™×œ×“/×” ×©×”×¦×˜×¨×¤×• ×œ×ž×©×¤×—×”',
    name_en: "ID appendix showing the child added to the family",
  },

  special_ed_approval: {
    id: "special_ed_approval",
    category: "family",
    aliases: ["Special_Ed_Approval"],
    airtable_type: "Special_Ed_Approval",
    name_he: '××™×©×•×¨ ×•×¢×“×ª ×”×©×ž×”/×•×¢×“×ª ×©×™×œ×•×‘ ×¢×‘×•×¨ ×”×™×œ×“ (×—×™× ×•×š ×ž×™×•×—×“)',
    name_en: "Placement/integration committee approval (special education) for the child",
  },

  child_disability_approval: {
    id: "child_disability_approval",
    category: "family",
    aliases: ["Child_Disability_Approval"],
    airtable_type: "Child_Disability_Approval",
    name_he: '××™×©×•×¨ ×©× ×ª×™ ×œ×©× ×ª {year} ×¢×œ ×ª×§×‘×•×œ×™ ×§×¦×‘×ª × ×›×•×ª ×ž×‘×™×˜×•×— ×œ××•×ž×™ ×¢×‘×•×¨ ×”×™×œ×“/×”',
    name_en: "Annual certificate for {year} of child disability allowance from NII",
  },

  alimony_judgment: {
    id: "alimony_judgment",
    category: "family",
    aliases: ["Alimony_Judgment"],
    airtable_type: "Alimony_Judgment",
    name_he: '×¤×¡×§ ×“×™×Ÿ / ×”×¡×›× ×’×™×¨×•×©×™×Ÿ (×“×ž×™ ×ž×–×•× ×•×ª)',
    name_en: "Court judgment / divorce agreement (alimony)",
  },

  nii_disability_allowance_cert: {
    id: "nii_disability_allowance_cert",
    category: "benefits",
    aliases: ["NII_Allowance_Cert"],
    airtable_type: "NII_Allowance_Cert",
    name_he: '××™×©×•×¨ ×©× ×ª×™ ×œ×©× ×ª {year} ×¢×œ ×ª×§×‘×•×œ×™ ×“×ž×™ × ×›×•×ª ×©×”×ª×§×‘×œ×• ×ž×‘×™×˜×•×— ×œ××•×ž×™ - {name}',
    name_en: "Annual certificate for {year} of disability payments from NII - {name}",
    details: [
      {
        "key": "name",
        "type": "text",
        "label_he": "×©× ×ž×œ×",
        "label_en": "Full name",
        "placeholder_he": "×œ×“×•×’×ž×”: ×™×©×¨××œ ×™×©×¨××œ×™",
        "placeholder_en": "e.g.: John Doe"
      }
    ],
  },

  nii_allowance_cert_spouse: {
    id: "nii_allowance_cert_spouse",
    category: "benefits",
    aliases: ["NII_Allowance_Cert_Spouse"],
    airtable_type: "NII_Allowance_Cert_Spouse",
    name_he: '××™×©×•×¨ ×©× ×ª×™ ×ž×‘×™×˜×•×— ×œ××•×ž×™ ×œ×©× ×ª {year} ×‘×”×ª×× ×œ×¡×•×’ ×”×§×¦×‘×” ×©×œ ×‘×Ÿ/×‘×ª ×”×–×•×’ - {name}',
    name_en: "Annual NII certificate for {year} by benefit type (spouse) - {name}",
    details: [
      {
        "key": "name",
        "type": "text",
        "label_he": "×©× ×ž×œ×",
        "label_en": "Full name",
        "placeholder_he": "×œ×“×•×’×ž×”: ×™×©×¨××œ ×™×©×¨××œ×™",
        "placeholder_en": "e.g.: John Doe"
      }
    ],
  },

  nii_maternity_allowance_cert: {
    id: "nii_maternity_allowance_cert",
    category: "benefits",
    airtable_type: "NII_Maternity_Allowance_Cert",
    name_he: '××™×©×•×¨ ×©× ×ª×™ ×œ×©× ×ª {year} ×¢×œ ×ª×§×‘×•×œ×™ ×“×ž×™ ×œ×™×“×” ×ž×‘×™×˜×•×— ×œ××•×ž×™ ×¢×‘×•×¨ - {name}',
    name_en: "Annual certificate for {year} of maternity payments from NII for - {name}",
    details: [
      {
        "key": "name",
        "type": "text",
        "label_he": "×©× ×ž×œ×",
        "label_en": "Full name",
        "placeholder_he": "×œ×“×•×’×ž×”: ×™×©×¨××œ ×™×©×¨××œ×™",
        "placeholder_en": "e.g.: John Doe"
      }
    ],
  },

  insurance_tax_cert: {
    id: "insurance_tax_cert",
    category: "insurance",
    aliases: ["Insurance_Tax_Cert"],
    airtable_type: "Insurance_Tax_Cert",
    name_he: '××™×©×•×¨ ×©× ×ª×™ ×œ×ž×¡ ×”×›× ×¡×” ×œ×©× ×ª {year} (× ×§×¨× ×’× **×“×•×— ×©× ×ª×™ ×ž×§×•×¦×¨**) ×¢×œ ×”×”×¤×§×“×•×ª ×œ{product} ×‘"{company}"',
    name_en: "Annual tax certificate for {year} (also called a shortened annual report) for contributions to {product} at \"{company}\"",
    details: [
      {
        "key": "product",
        "type": "select",
        "label_he": "×¡×•×’ ×”×ž×•×¦×¨",
        "label_en": "Product type",
        "options_he": [
          "×‘×™×˜×•×— ×—×™×™×",
          "××•×‘×“×Ÿ ×›×•×©×¨ ×¢×‘×•×“×”",
          "×§×¨×Ÿ ×”×©×ª×œ×ž×•×ª"
        ],
        "options_en": [
          "Life insurance",
          "Work capacity loss",
          "Study fund"
        ]
      },
      {
        "key": "company",
        "type": "text",
        "label_he": "×©× ×”×—×‘×¨×”",
        "label_en": "Company name",
        "placeholder_he": "×œ×“×•×’×ž×”: ×”×¨××œ",
        "placeholder_en": "e.g.: Harel"
      }
    ],
  },

  pension_withdrawal: {
    id: "pension_withdrawal",
    category: "insurance",
    aliases: ["Pension_Withdrawal"],
    airtable_type: "Pension_Withdrawal",
    name_he: '××™×©×•×¨ ×¢×œ ×ž×©×™×›×ª {withdrawal_type} ×œ×©× ×ª {year} ×•×”×ž×¡ ×©× ×•×›×” ×‘×¢×ª ×”×ž×©×™×›×”',
    name_en: "Certificate of {withdrawal_type} withdrawal for {year} and tax withheld at withdrawal",
    details: [
      {
        "key": "withdrawal_type",
        "type": "select",
        "label_he": "×¡×•×’ ×”×ž×©×™×›×”",
        "label_en": "Withdrawal type",
        "options_he": [
          "×¤×™×¦×•×™×™ ×¤×™×˜×•×¨×™×Ÿ",
          "×ž×¢× ×§ ×¤×¨×™×©×”",
          "×ž×©×™×›×ª ×§×¨×Ÿ ×¤× ×¡×™×”",
          "×ž×©×™×›×ª ×§×¨×Ÿ ×”×©×ª×œ×ž×•×ª",
          "×ž×©×™×›×ª ×§×•×¤×ª ×’×ž×œ ×œ×”×©×§×¢×”"
        ],
        "options_en": [
          "Severance pay",
          "Retirement grant",
          "Pension fund withdrawal",
          "Study fund withdrawal",
          "Investment provident fund withdrawal"
        ]
      }
    ],
  },

  rent_contract_income: {
    id: "rent_contract_income",
    category: "housing",
    aliases: ["Rent_Contract_Income"],
    airtable_type: "Rent_Contract_Income",
    name_he: '×—×•×–×” ×©×›×™×¨×•×ª ×©×œ ×”×“×™×¨×” ×©×”×©×›×¨×ª (×”×›× ×¡×”)',
    name_en: "Rental contract of the apartment you rented out (income)",
  },

  rent_contract_expense: {
    id: "rent_contract_expense",
    category: "housing",
    aliases: ["Rent_Contract_Expense"],
    airtable_type: "Rent_Contract_Expense",
    name_he: '×—×•×–×” ×©×›×™×¨×•×ª ×©×œ ×”×“×™×¨×” ×©×©×›×¨×ª ×œ×ž×’×•×¨×™× (×”×•×¦××”)',
    name_en: "Rental contract of the apartment you rented for living (expense)",
  },

  degree_cert: {
    id: "degree_cert",
    category: "education",
    aliases: ["Degree_Cert"],
    airtable_type: "Degree_Cert",
    name_he: '××™×©×•×¨ ×–×›××•×ª ×œ×ª×•××¨ ××§×“×ž×™ ×ž{institution}',
    name_en: "Academic degree eligibility certificate from {institution}",
    details: [
      {
        "key": "institution",
        "type": "text",
        "label_he": "×ž×•×¡×“ ×œ×™×ž×•×“×™×",
        "label_en": "Institution",
        "placeholder_he": "×œ×“×•×’×ž×”: ××•× ×™×‘×¨×¡×™×˜×ª ×ª×œ ××‘×™×‘",
        "placeholder_en": "e.g.: Tel Aviv University"
      }
    ],
  },

  donation_receipts: {
    id: "donation_receipts",
    category: "other",
    aliases: ["Donation_Receipts"],
    airtable_type: "Donation_Receipts",
    name_he: '×§×‘×œ×•×ª ×ª×¨×•×ž×•×ª ×ž×¨×•×›×–×•×ª (×™×© ×œ×©×œ×•×— ×§×‘×œ×•×ª ×¨×§ ×ž×ž×•×¡×“×•×ª ×©×œ×”× ×™×© ×¡×¢×™×£ 46. × ×™×ª×Ÿ ×œ×¨××•×ª ×–××ª ×‘×§×‘×œ×”)',
    name_en: "Consolidated donation receipts (only from institutions with Section 46; appears on the receipt)",
  },

  memorial_receipts: {
    id: "memorial_receipts",
    category: "other",
    aliases: ["Memorial_Receipts"],
    airtable_type: "Memorial_Receipts",
    name_he: '×§×‘×œ×•×ª ×•×ž×¡×ž×›×™× **×¨×œ×•×•× ×˜×™×™×** ×¢×œ ×”×•×¦××•×ª ×”× ×¦×—×”',
    name_en: "Relevant receipts and documents for memorial expenses",
  },

  institution_approval: {
    id: "institution_approval",
    category: "other",
    aliases: ["Institution_Approval"],
    airtable_type: "Institution_Approval",
    name_he: '×ž×¡×ž×š ×¨×©×ž×™ ×¨×œ×•×•× ×˜×™ ×¢×œ ×”×—×–×§×ª ×§×¨×•×‘ ×ž×©×¤×—×” ×‘×ž×•×¡×“',
    name_en: "Official relevant document for maintaining a family member in an institution",
  },

  medical_committee: {
    id: "medical_committee",
    category: "other",
    aliases: ["Medical_Committee"],
    airtable_type: "Medical_Committee",
    name_he: '×ž×¡×ž×š ×¨×©×ž×™ ×¨×œ×•×•× ×˜×™ ×¢×œ ×”×¤×˜×•×¨/× ×›×•×ª (×ž×¡×ž×›×™× ×¨×¤×•××™×™×/×•×¢×“×” ×¨×¤×•××™×ª)',
    name_en: "Official document regarding exemption/disability (medical docs / medical committee)",
  },

  foreign_income_report: {
    id: "foreign_income_report",
    category: "other",
    aliases: ["Foreign_Income_Report"],
    airtable_type: "Foreign_Income_Report",
    name_he: '××¡×ž×›×ª××•×ª ×¢×œ ×”×”×›× ×¡×” ×•×¢×œ ×”×ž×¡ ×©×©×•×œ× ×‘×—×•"×œ',
    name_en: "Proof of foreign income and tax paid abroad",
  },

  wht_income_tax: {
    id: "wht_income_tax",
    category: "business",
    aliases: ["WHT_Income_Tax"],
    airtable_type: "WHT_Income_Tax",
    name_he: "××™×©×•×¨ ×©× ×ª×™ ×¢×œ × ×™×›×•×™ ×ž×¡ ×‘×ž×§×•×¨ (×ž×¡ ×”×›× ×¡×”) ×ž×”×œ×§×•×—",
    name_en: "Annual certificate of withholding tax (Income Tax) withheld from client",
    details: [
      {
        key: "client", type: "text", label_he: "×©× ×”×œ×§×•×—/×”", label_en: "Client name",
        placeholder_he: '×œ×“×•×’×ž×”: ×—×‘×¨×ª XYZ ×‘×¢"×ž', placeholder_en: "e.g.: XYZ Ltd."
      }
    ],
  },

  wht_nii: {
    id: "wht_nii",
    category: "business",
    aliases: ["WHT_NII"],
    airtable_type: "WHT_NII",
    name_he: '××™×©×•×¨ ×©× ×ª×™ ×¢×œ × ×™×›×•×™ ×‘×™×˜×•×— ×œ××•×ž×™ ×ž×”×œ×§×•×— (× ×™×›×•×™ ×‘×ž×§×•×¨)',
    name_en: "Annual certificate of National Insurance withheld from client",
    details: [
      {
        key: "client", type: "text", label_he: "×©× ×”×œ×§×•×—/×”", label_en: "Client name",
        placeholder_he: '×œ×“×•×’×ž×”: ×—×‘×¨×ª XYZ ×‘×¢"×ž', placeholder_en: "e.g.: XYZ Ltd."
      }
    ],
  },

  inventory_list: {
    id: "inventory_list",
    category: "business",
    aliases: ["Inventory_List"],
    airtable_type: "Inventory_List",
    name_he: '×¨×©×™×ž×ª ×¡×¤×™×¨×ª ×ž×œ××™ ×œ×™×•× ×”××—×¨×•×Ÿ ×©×œ ×©× ×ª ×”×ž×¡',
    name_en: "Inventory count list as of the last day of the tax year",
  },

  gambling_win_cert: {
    id: "gambling_win_cert",
    category: "other",
    aliases: ["Gambling_Win_Cert"],
    airtable_type: "Gambling_Win_Cert",
    name_he: '××¡×ž×›×ª××•×ª ×¢×œ ×”×–×›×™×™×” ×•×”×ž×¡ ×©× ×•×›×” (×”×™×ž×•×¨×™×/×¤×¨×¡×™× ×ž×¢×œ 25,000 ×©"×—)',
    name_en: "Proof of winnings and tax withheld (gambling/prizes over 25,000 NIS)",
  },

  general_doc: {
    id: "general_doc",
    category: "other",
    aliases: ["General_Doc"],
    airtable_type: "General_Doc",
    name_he: '××™×©×•×¨×™×/××¡×ž×›×ª××•×ª ×¢×œ ×”×›× ×¡×•×ª × ×•×¡×¤×•×ª ×‘×©× ×ª ×”×ž×¡ (×©××™× ×Ÿ ×ž×•×¤×™×¢×•×ª ×‘×©××œ×•×Ÿ)',
    name_en: "Proof of additional income during the tax year (not listed in the questionnaire)",
  },

};

// ============================================
// HELPER FUNCTIONS (Exported)
// ============================================

/**
 * Format document name with parameters
 */
export function formatDocumentName(typeId, params = {}, options = {}) {
  const lang = options.lang || 'he';
  const docDef = DOCUMENT_TYPES[typeId];
  if (!docDef) return typeId;

  let text = lang === 'he' ? docDef.name_he : docDef.name_en;

  // Replace standard placeholders
  text = text.replace('{year}', params.year || '____');

  // Replace dynamic details
  if (docDef.details) {
    docDef.details.forEach(detail => {
      const key = detail.key;
      const value = params[key] || (options.mode === 'html' ? `<span class="missing-param">[${detail['label_' + lang]}]</span>` : `[${detail['label_' + lang]}]`);
      text = text.replace(`{${key}}`, value);
    });
  }

  // Handle markdown-style bold (**text**)
  if (options.mode !== 'text') {
    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
  } else {
    text = text.replace(/\*\*(.*?)\*\*/g, '$1');
  }

  return text;
}

/**
 * Generate HTML options for Select dropdown
 */
export function getDocumentDropdownOptions(options = {}) {
  const lang = options.lang || 'he';
  const includeGroups = options.includeCategoryGroups !== false;

  let html = '';

  if (includeGroups) {
    // Group by category
    const groups = {};
    // Use defined order for docs within categories if possible?
    // Actually, we just iterate DOCUMENT_TYPES which is ordered.
    Object.values(DOCUMENT_TYPES).forEach(doc => {
      const cat = doc.category || 'other';
      if (!groups[cat]) groups[cat] = [];
      groups[cat].push(doc);
    });

    // Use defined order for categories
    Object.keys(CATEGORIES).forEach(catKey => {
      if (groups[catKey]) {
        const catDef = CATEGORIES[catKey];
        const catLabel = lang === 'he' ? catDef.he : catDef.en;
        html += `<optgroup label="${catDef.emoji} ${catLabel}">`;

        groups[catKey].forEach(doc => {
          const name = formatDocumentName(doc.id, { year: 'YYYY' }, { lang, mode: 'text' });
          html += `<option value="${doc.id}">${name}</option>`;
        });

        html += `</optgroup>`;
      }
    });
  } else {
    // Flat list
    Object.values(DOCUMENT_TYPES).forEach(doc => {
      const name = formatDocumentName(doc.id, { year: 'YYYY' }, { lang, mode: 'text' });
      html += `<option value="${doc.id}">${name}</option>`;
    });
  }

  return html;
}

/**
 * Check if document requires user details input
 */
export function requiresDetails(typeId) {
  const doc = DOCUMENT_TYPES[typeId];
  return doc && doc.details && doc.details.length > 0;
}

/**
 * Get details schema for input generation
 */
export function getDetailsSchema(typeId) {
  const doc = DOCUMENT_TYPES[typeId];
  return doc ? doc.details : [];
}
